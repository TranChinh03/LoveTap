CREATE DATABASE LOVETAP

USE  LOVETAP
SELECT CONVERT (date, GETDATE()) -- Without hours, minutes and seconds.

SET DATEFORMAT DMY


CREATE TABLE NHANVIEN (
	MANV INT PRIMARY KEY,
	HOTEN NVARCHAR(255),
	NTNS SMALLDATETIME,
	SDT VARCHAR(30),
	DIACHI NVARCHAR(255),
	HESOLUONG FLOAT,
	LUONGCB FLOAT,
	MACN INT,
	VAITRO BIT, 
	EMAIL NVARCHAR(255)
)



CREATE TABLE CHINHANH  (
	MACN INT IDENTITY NOT NULL PRIMARY KEY,
	TENCN NVARCHAR(255),
	DIACHI NVARCHAR(255),
	MAADMIN INT FOREIGN KEY REFERENCES NHANVIEN(MANV),
	EMAIL NVARCHAR(255),
)


CREATE TABLE KHACHHANG  (
	MAKH INT IDENTITY NOT NULL PRIMARY KEY,
	HOTEN NVARCHAR(255),
	SDT VARCHAR(30),
	DIACHI NVARCHAR(255),
	NGDK SMALLDATETIME,
	DOANHSO FLOAT,
	MANV INT FOREIGN KEY REFERENCES NHANVIEN(MANV),
	NGSINH SMALLDATETIME,
	MACN INT FOREIGN KEY REFERENCES CHINHANH(MACN)
)


CREATE TABLE NHACUNGCAP (
	MANCC INT IDENTITY NOT NULL PRIMARY KEY,
	TEN NVARCHAR(255),
	SDT NVARCHAR(30),
	DIACHI NVARCHAR(255),
	EMAIL NVARCHAR(255),
)

SELECT * FROM KHACHHANG
CREATE TABLE HOADON (
	MAHD INT IDENTITY NOT NULL PRIMARY KEY,
	NGMUA SMALLDATETIME,
	TONGTIEN FLOAT,
	--LOAIHD BIT,
	MANV INT FOREIGN KEY REFERENCES NHANVIEN(MANV),
	MAKH INT FOREIGN KEY REFERENCES KHACHHANG(MAKH),
	MACN INT FOREIGN KEY REFERENCES CHINHANH(MACN),
)

CREATE TABLE PHIEUNHAP(
	MAPN INT IDENTITY NOT NULL PRIMARY KEY,
	NGNHAP SMALLDATETIME,
	TONGTIEN FLOAT,
	MANV INT FOREIGN KEY REFERENCES NHANVIEN(MANV),
	MANCC INT FOREIGN KEY REFERENCES NHACUNGCAP(MANCC),
	MACN INT FOREIGN KEY REFERENCES CHINHANH(MACN), 
)

CREATE TABLE DANHMUC (
	MADM INT IDENTITY NOT NULL PRIMARY KEY,
	TENDM NVARCHAR(255),
)

CREATE TABLE SANPHAM (
	MASP INT IDENTITY NOT NULL PRIMARY KEY,
	TEN NVARCHAR(255),
	GIA FLOAT,
	NUOCSX NVARCHAR(255),
	CHITIET NVARCHAR(255),
	MADM INT FOREIGN KEY REFERENCES DANHMUC(MADM),
)

CREATE TABLE CTHD (
	MAHD INT FOREIGN KEY REFERENCES HOADON (MAHD),
	MASP INT FOREIGN KEY REFERENCES SANPHAM (MASP),
	SOLUONG INT,
	CONSTRAINT PK_CTHD PRIMARY KEY (MAHD, MASP)
)

CREATE TABLE CTPN (
	MAPN INT FOREIGN KEY REFERENCES PHIEUNHAP(MAPN),
	MASP INT FOREIGN KEY REFERENCES SANPHAM (MASP),
	SOLUONG INT,
	CONSTRAINT PK_CTPN PRIMARY KEY (MAPN, MASP),
)


CREATE TABLE KHO (
	MAKHO INT IDENTITY NOT NULL PRIMARY KEY,
	TENKHO NVARCHAR(255),
	DIACHI NVARCHAR(255),
	DIENTICH FLOAT,
	MANQL INT FOREIGN KEY REFERENCES NHANVIEN(MANV),
)

CREATE TABLE TONKHO (
	MAKHO INT FOREIGN KEY REFERENCES KHO (MAKHO),
	MASP INT FOREIGN KEY REFERENCES SANPHAM (MASP),
	SOLUONG INT,
	CONSTRAINT PK_TONKHO PRIMARY KEY (MAKHO, MASP)
)

CREATE TABLE BAOHANH (
	MAKH INT FOREIGN KEY REFERENCES KHACHHANG (MAKH),
	MASP INT FOREIGN KEY REFERENCES SANPHAM (MASP),
	CONSTRAINT PK_BAOHANH PRIMARY KEY (MAKH, MASP)
)

--THÊM
CREATE TABLE LOGIN
(
	ID INT IDENTITY NOT NULL PRIMARY KEY,
	USERNAME VARCHAR(255),
	USERPASS VARCHAR(255),
)

--ALTER TABLE KHACHHANG ADD CONSTRAINT UQ_KHACHHANG UNIQUE (SDT)
--ALTER TABLE KHACHHANG DROP CONSTRAINT UQ_KHACHHANG
ALTER TABLE NHANVIEN ADD CONSTRAINT FK_NHANVIEN1 FOREIGN KEY (MANV) REFERENCES LOGIN(ID)


--THEM
ALTER TABLE NHANVIEN ADD CONSTRAINT FK_NHANVIEN FOREIGN KEY(MACN) REFERENCES CHINHANH(MACN)



INSERT INTO LOGIN VALUES ('admin1','6b2cd8cb828804a3d48f7baaa6de5a5e')
INSERT INTO LOGIN VALUES ('admin2','35c32087fe0e9f91f8b063a9b9bc46bc')
INSERT INTO LOGIN VALUES ('admin3','3372d6dd03e298317507858f5eedc7d0')
INSERT INTO LOGIN VALUES ('admin4','cfcc05861c48c71df7cd1bd3c916fbca')
INSERT INTO LOGIN VALUES ('admin5','fad7947df2deec5de293f2aad1dcb261')
INSERT INTO LOGIN VALUES ('admin6','ab7736a699d0b2a650ac10d5969f2d93')
INSERT INTO LOGIN VALUES ('admin7','e83f931fe4477213a0380b12eb91c8d1')
INSERT INTO LOGIN VALUES ('admin8','ac79349b3c1e9c34b1927e0e2da214cf')
INSERT INTO LOGIN VALUES ('admin9','531cbc6304d98d57a48faf621a874eac')
INSERT INTO LOGIN VALUES ('admin10','3adf20ae4e95429953185f54e6239d34')
INSERT INTO LOGIN VALUES ('staff1','15ea5540544c00e1530ccc5aad1b7bb7')
INSERT INTO LOGIN VALUES ('staff2','3878d341de7d00ef13891966ec547b20')
INSERT INTO LOGIN VALUES ('staff3','98ee81a9e5fa68e50e781ac26fb38d43')
INSERT INTO LOGIN VALUES ('staff4','7741839c8b1b71c398935d811a499c19')
INSERT INTO LOGIN VALUES ('staff5','049ff835916ba087dd82e439d6cdf730')
INSERT INTO LOGIN VALUES ('staff6','16b8547922093156d18f3a7c06ff785f')
INSERT INTO LOGIN VALUES ('staff7','664d7ef990b335155b788d39accdb237')
INSERT INTO LOGIN VALUES ('staff8','2565e16ceb853d020f5ffb76e53ffa5e')
INSERT INTO LOGIN VALUES ('staff9','46ce289a5ea3be3ba357bd8bf27fdac5')
INSERT INTO LOGIN VALUES ('staff10','d969f68be9cb438c3731aa90c1e4ea4b')
SELECT * FROM LOGIN


ALTER TABLE NHANVIEN NOCHECK CONSTRAINT FK_NHANVIEN

INSERT INTO NHANVIEN(MANV,HOTEN, NTNS, SDT, DIACHI, HESOLUONG, LUONGCB, MACN, VAITRO, EMAIL) VALUES(1,N'Đỗ Phùng Gia Bảo','22/12/1999','0909657243',N'512 Điện Biên Phủ, Quận 3','0.6','6000000',1,'1','baodpg@gmail.com')
INSERT INTO NHANVIEN(MANV,HOTEN, NTNS, SDT, DIACHI, HESOLUONG, LUONGCB, MACN, VAITRO, EMAIL) VALUES(2,N'Nguyễn Hoàng Xuân Thảo','22/12/1999','0909657244',N'Hẻm 905 Nguyễn Đình Chiểu, Q3 ','0.3','6000000',2,'1','thaonhx@gmail.com')
INSERT INTO NHANVIEN(MANV,HOTEN, NTNS, SDT, DIACHI, HESOLUONG, LUONGCB, MACN, VAITRO, EMAIL) VALUES(3,N'Huỳnh Thế Hào','22/12/1999','0909657245',N'Hẻm 719 Nguyễn Đình Chiểu ','0.9','8000000',3,'1','haoht@gmail.com')
INSERT INTO NHANVIEN(MANV,HOTEN, NTNS, SDT, DIACHI, HESOLUONG, LUONGCB, MACN, VAITRO, EMAIL) VALUES(4,N'Hoàng Đình Hiếu','22/12/1999','0909657246',N'578 Tôn Thất Thuyết ','0.3','6000000',4,'1','hieuhd@gmail.com')
INSERT INTO NHANVIEN(MANV,HOTEN, NTNS, SDT, DIACHI, HESOLUONG, LUONGCB, MACN, VAITRO, EMAIL) VALUES(5,N'Phan Hoàng Tuấn','22/12/1999','0909657247',N'888 đường 48, phường 2, Quận 4 ','0.6','12000000',5,'1','tuanph@gmail.com')
INSERT INTO NHANVIEN(MANV,HOTEN, NTNS, SDT, DIACHI, HESOLUONG, LUONGCB, MACN, VAITRO, EMAIL) VALUES(6,N'Lê Thị Thu Hằng','22/12/1999','0909657248',N'Số 05 Lô B2 chung cư phường 3, Quận 4 ','0.8','6000000',6,'1','hangltt@gmail.com')
INSERT INTO NHANVIEN(MANV,HOTEN, NTNS, SDT, DIACHI, HESOLUONG, LUONGCB, MACN, VAITRO, EMAIL) VALUES(7,N'Ngô Minh Phú','22/12/1999','0909657249',N'97 Phan Phú Tiên, phường 10, quận 5 ','0.4','7500000',7,'1','phunm@gmail.com')
INSERT INTO NHANVIEN(MANV,HOTEN, NTNS, SDT, DIACHI, HESOLUONG, LUONGCB, MACN, VAITRO, EMAIL) VALUES(8,N'Trần Bình Luật','22/12/1999','0909657250',N'Chung cư bellaza, đường số 2 7 Phú Mỹ','0.9','12000000',8,'1','luattb@gmail.com')
INSERT INTO NHANVIEN(MANV,HOTEN, NTNS, SDT, DIACHI, HESOLUONG, LUONGCB, MACN, VAITRO, EMAIL) VALUES(9,N'Dương Minh Lượng','22/12/1999','0909657251',N'Hẻm 850 Phạm Thế Hiển, P3 ','0.2','6000000',9,'1','luongdm@gmail.com')
INSERT INTO NHANVIEN(MANV,HOTEN, NTNS, SDT, DIACHI, HESOLUONG, LUONGCB, MACN, VAITRO, EMAIL) VALUES(10,N'Huỳnh Ngọc Quân','22/12/1999','0909657252',N'Số 95 đường 53 phường Tân Quy, Quận 7','0.7','7500000',10,'1','quanhn@gmail.com')
INSERT INTO NHANVIEN(MANV,HOTEN, NTNS, SDT, DIACHI, HESOLUONG, LUONGCB, MACN, VAITRO, EMAIL) VALUES(11,N'Phùng Gia Huy','22/12/1999','0909657253',N'555 Điện Biên Phủ, Quận 3','0.6','6000000',1,'0','huygp@gmail.com')
INSERT INTO NHANVIEN(MANV,HOTEN, NTNS, SDT, DIACHI, HESOLUONG, LUONGCB, MACN, VAITRO, EMAIL) VALUES(12,N'Trương Thị Mỹ Hà','22/12/1999','0909657254',N'Hẻm 404 Nguyễn Đình Chiểu, Q3 ','0.3','6000000',2,'0','hattm@gmail.com')
INSERT INTO NHANVIEN(MANV,HOTEN, NTNS, SDT, DIACHI, HESOLUONG, LUONGCB, MACN, VAITRO, EMAIL) VALUES(13,N'Lương Văn Tài','22/12/1999','0909657255',N'Hẻm 287, 289 Nguyễn Đình Chiểu ','0.9','8000000',3,'0','taivl@gmail.com')
INSERT INTO NHANVIEN(MANV,HOTEN, NTNS, SDT, DIACHI, HESOLUONG, LUONGCB, MACN, VAITRO, EMAIL) VALUES(14,N'Đinh Công Hiếu','22/12/1999','0909657256',N'209/43 Tôn Thất Thuyết ','0.3','6000000',4,'0','hieudc@gmail.com')
INSERT INTO NHANVIEN(MANV,HOTEN, NTNS, SDT, DIACHI, HESOLUONG, LUONGCB, MACN, VAITRO, EMAIL) VALUES(15,N'Ngô Hoài Nam','22/12/1999','0909657257',N'229 đường 48, phường 2, Quận 4 ','0.6','12000000',5,'0','namnh@gmail.com')
INSERT INTO NHANVIEN(MANV,HOTEN, NTNS, SDT, DIACHI, HESOLUONG, LUONGCB, MACN, VAITRO, EMAIL) VALUES(16,N'Lê Đặng Minh Khôi','22/12/1999','0909657258',N'Số 01 Lô B2 chung cư phường 3, Quận 4 ','0.8','6000000',6,'0','khoildm@gmail.com')
INSERT INTO NHANVIEN(MANV,HOTEN, NTNS, SDT, DIACHI, HESOLUONG, LUONGCB, MACN, VAITRO, EMAIL) VALUES(17,N'Đặng Trần Thiên Phú','22/12/1999','0909657259',N'04 Phan Phú Tiên, phường 10, quận 5 ','0.4','7500000',7,'0','phudtt@gmail.com')
INSERT INTO NHANVIEN(MANV,HOTEN, NTNS, SDT, DIACHI, HESOLUONG, LUONGCB, MACN, VAITRO, EMAIL) VALUES(18,N'Trần Minh Huy','22/12/1999','0909657260',N'Chung cư bellaza, đường số 2 7 Phú Mỹ','0.9','12000000',8,'0','huytm@gmail.com')
INSERT INTO NHANVIEN(MANV,HOTEN, NTNS, SDT, DIACHI, HESOLUONG, LUONGCB, MACN, VAITRO, EMAIL) VALUES(19,N'Bùi Ngọc Phát','22/12/1999','0909657261',N'Hẻm 280 Phạm Thế Hiển, P3 ','0.2','6000000',9,'0','phatbn@gmail.com')
INSERT INTO NHANVIEN(MANV,HOTEN, NTNS, SDT, DIACHI, HESOLUONG, LUONGCB, MACN, VAITRO, EMAIL) VALUES(20,N'Đinh Trung Quân','22/12/1999','0909657262',N'Số 67 đường 53 phường Tân Quy, Quận 7','0.7','7500000',10,'0','quandt@gmail.com')

ALTER TABLE NHANVIEN CHECK CONSTRAINT FK_NHANVIEN
SELECT * FROM NHANVIEN

INSERT INTO CHINHANH VALUES(N'LoveTap chi nhánh Đăk Lăk',N'75 Hàn Thuyên, TT EaDrang, Đăk Lăk',1, 'chinhanh1@gmail.com')	
INSERT INTO CHINHANH VALUES(N'LoveTap chi nhánh Bình Dương',N'77 Bình Thung, Bình An, Dĩ An, Binh Dương',2, 'chinhanh2@gmail.com')	
INSERT INTO CHINHANH VALUES(N'LoveTap chi nhánh TP. Hồ Chí Minh',N'88 Đường Số 8, Bình Hưng, Bình Chánh',3, 'chinhanh3@gmail.com')	
INSERT INTO CHINHANH VALUES(N'LoveTap chi nhánh Bình Phước',N'27 Nơ Trang Long, Đồng Xoài, Bình Phước',4, 'chinhanh4@gmail.com')	
INSERT INTO CHINHANH VALUES(N'LoveTap chi nhánh TP. Hồ Chí Minh',N'117/80 Hồ Văn Long; CC Lê Thành; P. Tân Tạo; Q. Bình Tân',5, 'chinhanh5@gmail.com')	
INSERT INTO CHINHANH VALUES(N'LoveTap chi nhánh TP. Hồ Chí Minh',N'26 Trần Quý Cáp P11 Q Bình Thạnh',6, 'chinhanh6@gmail.com')	
INSERT INTO CHINHANH VALUES(N'LoveTap chi nhánh Bình Dương',N'12 Nguyễn Văn Việt, Thuận An, Binh Dương',7, 'chinhanh7@gmail.com')	
INSERT INTO CHINHANH VALUES(N'LoveTap chi nhánh Đăk Lăk',N'Km72, EaNam, EaHLeo, Đăk Lăk',8, 'chinhanh8@gmail.com')	
INSERT INTO CHINHANH VALUES(N'LoveTap chi nhánh Đăk Nông',N'123 Nguyễn Du, TP Gia Nghĩa, Đăk Nông',9, 'chinhanh9@gmail.com')	
INSERT INTO CHINHANH VALUES(N'LoveTap chi nhánh Đăk Lăk',N'Thôn 2A, EaSir, EaHLeo, Đăk Lăk',10, 'chinhanh10@gmail.com')

SELECT * FROM CHINHANH


INSERT INTO KHACHHANG VALUES(N'Nguyễn Hoàng Duy','0908200585',N'Hẻm 133 Hòa Hưng, phường 12,quận 10 ','20/11/2021','19350000', 11, '5/5/1999', 1)
INSERT INTO KHACHHANG VALUES(N'Lê Đăng Dũng','0908200586',N'Tổ 7, KP 1A, Đông Hưng Thuận 12 Đông Hưng Thuận','20/8/2021','21100000', 12, '15/9/2006', 2)
INSERT INTO KHACHHANG VALUES(N'Tạ Việt Hoàng','0908200587',N'Hẻm 392 Cao Thắng, phường 12, quận 10 ','8/8/2021','35350000', 13, '6/7/2003', 3)
INSERT INTO KHACHHANG VALUES(N'Nguyễn Hoàng Quốc Ấn','0908200588',N'Tổ 7, KP 1A, Đông Hưng Thuận 12 Đông Hưng Thuận','19/2/2022','37100000', 14, '5/9/2004', 4)
INSERT INTO KHACHHANG VALUES(N'Lê Kim Danh','0908200589',N'Tổ 10, KP2 Đông Hưng Thuận 12 Đông Hưng Thuận','15/5/2021','450000', 15, '5/9/2005', 5)
INSERT INTO KHACHHANG VALUES(N'Tô Thị Mỹ Âu','0908200590',N'Hẻm 481 ( KP4, Đông Hưng Thuận) 12 Đông Hưng Thuận','1/5/2022','100000', 16, '3/4/1998', 6)
INSERT INTO KHACHHANG VALUES(N'Nguyễn Hoàng Kim Ngân','0908200591',N'523/28/2 Lê Văn Khương, KP 5,Hiệp Thành 12 Hiệp Thành','30/7/2021','350000', 17, '2/6/2001', 7)
INSERT INTO KHACHHANG VALUES(N'Tô Trọng Nghĩa','0908200592',N'P404 số 60, tổ 6, KP7 THT 12 Tân Hưng Thuận','11/12/2021','18450000', 18, '18/1/2002', 8)
INSERT INTO KHACHHANG VALUES(N'Trần Nguyễn Đức Huy','0908200593',N'Chung cư Hưng Ngân (48A đường Dương Thị Mười, phường Tân Chánh Hiệp, quận 12)','3/7/2021','56000000', 19, '17/7/2006', 9)
INSERT INTO KHACHHANG VALUES(N'Đoàn Gia Thịnh','0908200594',N'Chung cư Topaz Home 102 Phan Văn Hớn, Tân Thới Nhất, Quận 12','19/8/2022','450000', 20, '5/7/1999', 10)

SELECT * FROM KHACHHANG
DELETE FROM KHACHHANG

INSERT INTO HOADON VALUES('19/10/2022','19350000',11,1,1)
INSERT INTO HOADON VALUES('20/10/2022','21100000',12,2,2)
INSERT INTO HOADON VALUES('21/10/2022','35350000',13,3,3)
INSERT INTO HOADON VALUES('22/10/2022','37100000',14,4,4)
INSERT INTO HOADON VALUES('23/10/2022','450000',15,5,5)
INSERT INTO HOADON VALUES('24/10/2022','100000',16,6,6)
INSERT INTO HOADON VALUES('25/10/2022','350000',17,7,7)
INSERT INTO HOADON VALUES('26/10/2022','18450000',18,8,8)
INSERT INTO HOADON VALUES('27/10/2022','56000000',19,9,9)
INSERT INTO HOADON VALUES('28/10/2022','450000',20,10,10)

SELECT * FROM HOADON
DELETE FROM HOADON

INSERT INTO DANHMUC VALUES(N'Chuột - Lót chuột')
INSERT INTO DANHMUC VALUES(N'Bàn phím')
INSERT INTO DANHMUC VALUES(N'Màn hình')
INSERT INTO DANHMUC VALUES(N'Linh kiện ')
INSERT INTO DANHMUC VALUES(N'Laptop')
INSERT INTO DANHMUC VALUES(N'Card màn hình')
INSERT INTO DANHMUC VALUES(N'Tai nghe')

SELECT * FROM DANHMUC
DELETE FROM DANHMUC

INSERT INTO SANPHAM VALUES(N'Laptop Gaming ASUS','19000000','China','2.2kg, 16GB RAM',5)
INSERT INTO SANPHAM VALUES(N'Laptop Vivobook','20999000','USA','1.5kg, 8GB RAM',5)
INSERT INTO SANPHAM VALUES(N'Laptop Macbook','21000000','Vietnam','2.2kg, 8GB RAM',5)
INSERT INTO SANPHAM VALUES(N'Laptop HP','35000000','Korea','2.2kg, 8GB RAM',5)
INSERT INTO SANPHAM VALUES(N'Laptop Dell','37000000','Singapore','2.2kg, 16GB RAM',5)
INSERT INTO SANPHAM VALUES(N'Laptop MSI','56000000','France','2.2kg, 16GB RAM',5)
INSERT INTO SANPHAM VALUES(N'Laptop Acer','15000000','USA','2.2kg, 16GB RAM',5)
INSERT INTO SANPHAM VALUES(N'Pad chuột đen','100000','Vietnam','2.2kg, 16GB RAM',1)
INSERT INTO SANPHAM VALUES(N'Chuột không dây Logitech','350000','China ','2.2kg, 16GB RAM',1)
INSERT INTO SANPHAM VALUES(N'Laptop Samsung','18000000','Korea','2.2kg, 16GB RAM',5)

SELECT * FROM SANPHAM
DELETE FROM SANPHAM

INSERT INTO KHO VALUES(N'Kho LoveTap chi nhánh Đăk Lăk',N'123 Đắk Lắk','7000',1)	
INSERT INTO KHO VALUES(N'Kho LoveTap chi nhánh Bình Dương',N'456 Dĩ An, Bình Dương','5000',2)	
INSERT INTO KHO VALUES(N'Kho LoveTap chi nhánh Thủ Đức',N'69 Thủ Đức, TPHCM','10000',3)	
INSERT INTO KHO VALUES(N'Kho LoveTap chi nhánh Bình Phước',N'96 Bình Phước','9000',4)	
INSERT INTO KHO VALUES(N'Kho LoveTap chi nhánh Quận 1',N'37 Quận 1, TPHCM','6000',5)	
INSERT INTO KHO VALUES(N'Kho LoveTap chi nhánh Bình Thạnh',N'547 Quận Bình Thạnh, TPHCM','5500',6)	
INSERT INTO KHO VALUES(N'Kho LoveTap chi nhánh Bình Dương',N'72 Bình Dương','6800',7)	
INSERT INTO KHO VALUES(N'Kho LoveTap chi nhánh Đăk Lăk',N'121 Đắk Lắk','9800',8)	
INSERT INTO KHO VALUES(N'Kho LoveTap chi nhánh Đăk Nông',N'92 Đắk Nông','7000',9)	
INSERT INTO KHO VALUES(N'Kho LoveTap chi nhánh Đăk Lăk',N'57 Đắk Lắk','7500',10)	

SELECT * FROM KHO
DELETE FROM KHO

INSERT INTO CTHD VALUES(1,1,'1')
INSERT INTO CTHD VALUES(1,9,'1')
INSERT INTO CTHD VALUES(2,3,'1')
INSERT INTO CTHD VALUES(2,8,'1')
INSERT INTO CTHD VALUES(3,4,'1')
INSERT INTO CTHD VALUES(3,9,'1')
INSERT INTO CTHD VALUES(4,5,'1')
INSERT INTO CTHD VALUES(4,8,'1')
INSERT INTO CTHD VALUES(5,8,'1')
INSERT INTO CTHD VALUES(5,9,'1')
INSERT INTO CTHD VALUES(6,8,'1')
INSERT INTO CTHD VALUES(7,9,'1')
INSERT INTO CTHD VALUES(8,8,'1')
INSERT INTO CTHD VALUES(8,9,'1')
INSERT INTO CTHD VALUES(8,10,'1')
INSERT INTO CTHD VALUES(9,6,'1')
INSERT INTO CTHD VALUES(10,8,'1')
INSERT INTO CTHD VALUES(10,9,'1')

SELECT * FROM CTHD
DELETE FROM CTHD

INSERT INTO TONKHO VALUES(1,1,'50')
INSERT INTO TONKHO VALUES(2,2,'40')
INSERT INTO TONKHO VALUES(3,3,'45')
INSERT INTO TONKHO VALUES(4,4,'55')
INSERT INTO TONKHO VALUES(5,5,'100')
INSERT INTO TONKHO VALUES(6,6,'80')
INSERT INTO TONKHO VALUES(7,7,'76')
INSERT INTO TONKHO VALUES(8,8,'200')
INSERT INTO TONKHO VALUES(9,9,'300')
INSERT INTO TONKHO VALUES(10,10,'40')

SELECT * FROM TONKHO
DELETE FROM TONKHO

INSERT INTO BAOHANH VALUES(1,9)
INSERT INTO BAOHANH VALUES(2,3)
INSERT INTO BAOHANH VALUES(3,4)
INSERT INTO BAOHANH VALUES(4,8)
INSERT INTO BAOHANH VALUES(5,9)
INSERT INTO BAOHANH VALUES(6,8)
INSERT INTO BAOHANH VALUES(7,9)
INSERT INTO BAOHANH VALUES(8,8)
INSERT INTO BAOHANH VALUES(9,6)
INSERT INTO BAOHANH VALUES(10,9)

SELECT * FROM BAOHANH
DELETE FROM BAOHANH


INSERT INTO NHACUNGCAP VALUES(N'Công ty ASUS VN','1800-6588',N'123 Nguyễn Tất Thành, TPHCM','support@asus.com')
INSERT INTO NHACUNGCAP VALUES(N'Công ty Samsung VN','1800-1234',N'169/1 Vo Thi Sau, Ward 7, Dist.3','support@samsung.com')
INSERT INTO NHACUNGCAP VALUES(N'Công ty HP VN','1800-1235',N'4 LE LOI STREET, WARD 1','support@hp.com')
INSERT INTO NHACUNGCAP VALUES(N'Công ty Dell VN','1800-1947',N'29 - 31 Nguyen Van Troi, Ward 12','support@dell.com')
INSERT INTO NHACUNGCAP VALUES(N'Công ty Acer VN','1800-4853',N'3 Thach Lam St., Hiep Tan Ward','support@acer.com')
INSERT INTO NHACUNGCAP VALUES(N'Công ty Logitech VN','1800-2845',N'25 Block 12A Street 10, Trung Hoa Ward','support@logitech.com')
INSERT INTO NHACUNGCAP VALUES(N'Công ty linh kiện DareU VN','1800-2935',N'100 Phan Van Hon Street, District 12','support@dareu.com')
INSERT INTO NHACUNGCAP VALUES(N'Công ty MSI VN','1800-4953',N'602 - 604 Le Duc Tho, Ward 15, District Go Vap','support@msi.com')
INSERT INTO NHACUNGCAP VALUES(N'Công ty Sony VN','1800-2945',N'130/C12 Pham Văn Hai, Ward 2','support@sony.com')
INSERT INTO NHACUNGCAP VALUES(N'Công ty Corsair VN','1800-2944',N'11B Nguyen Sieu, Hoan Kiem, Ha Noi','support@corsair.com')

SELECT * FROM NHACUNGCAP
DELETE FROM NHACUNGCAP


INSERT INTO PHIEUNHAP VALUES('1/1/2023','1900000000', 1,1,1)
INSERT INTO PHIEUNHAP VALUES('2/1/2023','2099900000',2,2,2)
INSERT INTO PHIEUNHAP VALUES('3/1/2023','2100000000',3,3,3)
INSERT INTO PHIEUNHAP VALUES('4/1/2023','7000000000',4,4,4)
INSERT INTO PHIEUNHAP VALUES('5/1/2023','7400000000',5,5,5)
INSERT INTO PHIEUNHAP VALUES('6/1/2023','11200000000',6,6,6)
INSERT INTO PHIEUNHAP VALUES('7/1/2023','4500000000',7,7,7)
INSERT INTO PHIEUNHAP VALUES('8/1/2023','30000000',8,8,8)
INSERT INTO PHIEUNHAP VALUES('9/1/2023','35000000',9,9,9)
INSERT INTO PHIEUNHAP VALUES('10/1/2023','1800000000',10,10,10)

SELECT * FROM PHIEUNHAP

DELETE FROM PHIEUNHAP

INSERT INTO CTPN VALUES('1','1','100')
INSERT INTO CTPN VALUES('2','2','100')
INSERT INTO CTPN VALUES('3','3','100')
INSERT INTO CTPN VALUES('4','4','200')
INSERT INTO CTPN VALUES('5','5','200')
INSERT INTO CTPN VALUES('6','6','200')
INSERT INTO CTPN VALUES('7','7','300')
INSERT INTO CTPN VALUES('8','8','300')
INSERT INTO CTPN VALUES('9','9','100')
INSERT INTO CTPN VALUES('10','10','100')

SELECT * FROM CTPN
DELETE FROM CTPN

CREATE TABLE CTSP(
	MASP INT FOREIGN KEY REFERENCES SANPHAM(MASP),
	CPU VARCHAR(500),
	RAM VARCHAR(500),
	HD VARCHAR(500),
	VGA VARCHAR(500),
	SCREENSIZE VARCHAR(500),
	OS VARCHAR(500),
	COLOR VARCHAR(500),
	CONSTRAINT PK_CTSP PRIMARY KEY(MASP)
)


SELECT * FROM CTSP

INSERT INTO CTSP VALUES(1,'AMD Ryzen 7-4800H, 2.9GHz up to 4.2GHz, 8 cores 16 threads','8GB DDR4 3200MHz','512GB M.2 NVMe™ PCIe® 3.0 SSD','NVIDIA Geforce GTX 1650 4GB GDDR6','15.6 inch FHD (1920 x 1080) IPS, Non-Glare, 144Hz AdaptiveSync','Windows 11 Home','Gray')
INSERT INTO CTSP VALUES(2,'Intel Core i5-12500H 2.5 GHz (18M Cache, up to 4.5 GHz, 4P+8E cores)','8GB (Onboard) DDR4 3200MHz (nâng cấp tối đa 16GB)','256GB M.2 NVMe™ PCIe® 3.0 SSD','Intel Iris Xe Graphics ','14" 2.8K (2880 x 1800) OLED 16:10 aspect ratio','Windows 11 Home','Transparent Silver')
INSERT INTO CTSP VALUES(3,'Apple M1 chip with 8‑core CPU, 7‑core GPU, and 16‑core Neural Engine','8GB LPDDR4','SSD 256GB','Apple 7-core GPU','13.3 inch, IPS LCD LED Backlit, True Tone','macOS','Gray')
INSERT INTO CTSP VALUES(4,'Intel Core i7-11800H','16GB (2x8GB) DDR4 3200Mhz','512GB SSD M.2 PCIE + 32GB Intel Optane memory (2x M.2 SATA/NVMe)','NVIDIA® GeForce RTX™ 3060 Laptop GPU + Intel® UHD Graphics','16.1" FHD (1920 x 1080) IPS, 144Hz','Windows 10 Home','Performance Blue')
INSERT INTO CTSP VALUES(5,'Intel Core i7-12700H (14 Cores 20 Threads, 24MB Cache, 3.5 GHz, Turbo Boost 4.7 GHz)','16GB (2x8GB) DDR5 4800MHz (2x SO-DIMM socket, up to 32GB SDRAM)','512GB SSD M.2 PCIe PCIE G4X4','NVIDIA GeForce RTX 3050Ti 4GB GDDR6','15.6-inch FHD (1920 x1080) 165Hz 300 nits WVA Anti-Glare LED Backlit Narrow Border Display','Windows 11 Home SL','Dark Shadow Grey')
INSERT INTO CTSP VALUES(6,'Intel Core i7-12700H 3.5GHz up to 4.7GHz 24MB','16GB (8GB x2) DDR4 3200MHz (2x SO-DIMM socket, up to 64GB SDRAM)','1TB NVMe PCIe SSD Gen4x4 (Còn trống 1 khe SSD M.2 PCIE)','NVIDIA® GeForce RTX™ 3070Ti 8GB GDDR6','15.6" QHD (2560x1440), 165Hz, 72%NTSC, IPS-Level, DCI-P3 100% typical','Windows 11 Home','Core Black')
INSERT INTO CTSP VALUES(7,'Intel Core i5-1135G7 2.4GHz up to 4.2GHz 8MB','8GB (4GBx2) DDR4 2666MHz  (1x SO-DIMM socket, up to 20GB SDRAM)','512GB SSD M.2 PCIE, 1x slot SATA3 2.5"','Intel® Iris® Xe Graphics','14" FHD (1920 x 1080) IPS, Acer ComfyView LCD','Windows 11 Home','Pure Silver ')
INSERT INTO CTSP VALUES(8,'NULL','NULL','NULL','NULL','450 x 400 x 5mm','NULL','Black')
INSERT INTO CTSP VALUES(9,'NULL','NULL','NULL','NULL','116.6 x 62.15 x 38.2','NULL','Black/White')
INSERT INTO CTSP VALUES(10,'CPU Intel Evo Core i5-1135G7 Processor 2.4 GHz up to 4.2 GHz.','8GB LPDDR4x RAM','SSD 256GB','Intel® Iris® Xe Graphics','13.3-inch Full HD AMOLED 16:9 display (1920 x 1080)','Windows 11 Home','White')


CREATE TABLE LOIICH(
	MASP INT FOREIGN KEY REFERENCES SANPHAM(MASP),
	LI1 NVARCHAR(255),
	LI2 NVARCHAR(255),
	LI3 NVARCHAR(255),
	LI4 NVARCHAR(255),
	CONSTRAINT PK_LOIICH PRIMARY KEY(MASP)
)


INSERT INTO LOIICH VALUES(1,N'Bảo hành chính hãng 24 tháng',N'Hỗ trợ đổi mới trong 7 ngày',N'Windows bản quyền tích hợp',N'Miễn phí giao hàng toàn quốc')
INSERT INTO LOIICH VALUES(2,N'Bảo hành chính hãng 24 tháng',N'Hỗ trợ đổi mới trong 7 ngày',N'Windows + Office bản quyền tích hợp',N'Miễn phí giao hàng toàn quốc')
INSERT INTO LOIICH VALUES(3,N'Bảo hành chính hãng 24 tháng',N'Hỗ trợ đổi mới trong 7 ngày',N'Windows bản quyền tích hợp',N'Miễn phí giao hàng toàn quốc')
INSERT INTO LOIICH VALUES(4,N'Bảo hành chính hãng 24 tháng',N'Hỗ trợ đổi mới trong 7 ngày',N'Windows + Office bản quyền tích hợp',N'Miễn phí giao hàng toàn quốc')
INSERT INTO LOIICH VALUES(5,N'Bảo hành chính hãng 24 tháng',N'Hỗ trợ đổi mới trong 7 ngày',N'Windows bản quyền tích hợp',N'Miễn phí giao hàng toàn quốc')
INSERT INTO LOIICH VALUES(6,N'Bảo hành chính hãng 24 tháng',N'Hỗ trợ đổi mới trong 7 ngày',N'Windows bản quyền tích hợp',N'Miễn phí giao hàng toàn quốc')
INSERT INTO LOIICH VALUES(7,N'Bảo hành chính hãng 24 tháng',N'Hỗ trợ đổi mới trong 7 ngày',N'Windows bản quyền tích hợp',N'Miễn phí giao hàng toàn quốc')
INSERT INTO LOIICH VALUES(8,N'Bảo hành chính hãng 1 tháng',N'Hỗ trợ đổi mới trong 3 ngày',N'Mua 2 tặng 1',N'Miễn phí giao hàng khi mua cùng hoá đơn trên 10.000.000đ')
INSERT INTO LOIICH VALUES(9,N'Bảo hành chính hãng 12 tháng',N'Hỗ trợ đổi mới trong 3 ngày',N'Giảm giá 50% khi mua với Laptop',N'Miễn phí giao hàng khi mua cùng hoá đơn trên 10.000.000đ')
INSERT INTO LOIICH VALUES(10,N'Bảo hành chính hãng 24 tháng',N'Hỗ trợ đổi mới trong 7 ngày',N'Windows + Office bản quyền tích hợp',N'Miễn phí giao hàng toàn quốc')



ALTER TABLE NHANVIEN ADD DELETED BIT
ALTER TABLE KHACHHANG ADD DELETED BIT
ALTER TABLE CHINHANH ADD DELETED BIT
ALTER TABLE HOADON ADD DELETED BIT
ALTER TABLE CTHD ADD DELETED BIT
ALTER TABLE KHO ADD DELETED BIT
ALTER TABLE DANHMUC ADD DELETED BIT
ALTER TABLE SANPHAM ADD DELETED BIT
ALTER TABLE TONKHO ADD DELETED BIT
ALTER TABLE BAOHANH ADD DELETED BIT
ALTER TABLE CTSP ADD DELETED BIT
ALTER TABLE LOIICH ADD DELETED BIT
ALTER TABLE NHACUNGCAP ADD DELETED BIT
ALTER TABLE CTPN ADD DELETED BIT
ALTER TABLE PHIEUNHAP ADD DELETED BIT
ALTER TABLE LOGIN ADD DELETED BIT


UPDATE NHANVIEN
SET DELETED = 0

UPDATE KHACHHANG
SET DELETED = 0

UPDATE CHINHANH
SET DELETED = 0

UPDATE HOADON
SET DELETED = 0

UPDATE CTHD
SET DELETED = 0

UPDATE SANPHAM
SET DELETED = 0

UPDATE CTSP
SET DELETED = 0

UPDATE PHIEUNHAP
SET DELETED = 0

UPDATE CTPN
SET DELETED = 0

UPDATE NHACUNGCAP
SET DELETED = 0

UPDATE LOIICH
SET DELETED = 0

UPDATE DANHMUC
SET DELETED = 0

UPDATE KHO
SET DELETED = 0

UPDATE TONKHO
SET DELETED = 0

UPDATE BAOHANH
SET DELETED = 0

UPDATE LOGIN
SET DELETED = 0

--TRG01: Ngày đăng ký của khách hàng hơn ngày sinh khách hàng
--TRG02: Doanh số của khách hàng bằng tổng tất cả tiền hóa đơn mà khách hàng đó mua
--TRG03: Tổng tiền của một hóa đơn bằng tổng số lượng * giá tiền
---------------------------------------------------------------------
CREATE TRIGGER TRG01_INS_KHACHHANG ON KHACHHANG
FOR INSERT
AS
BEGIN
		IF( EXISTS (
				SELECT *
				FROM inserted
				WHERE NGDK < NGSINH))
				BEGIN
					PRINT 'TRG01 INSERT KH ERROR...'
					ROLLBACK TRAN
				END
		ELSE
			PRINT 'TRG01 INSERT KH SUCCESFULLY'
END

DROP TRIGGER TRG01_INS_KHACHHANG

INSERT INTO KHACHHANG VALUES(N'Trần Phúc','0908200595',N'Chung cư Topaz Home 115 Phan Văn Hớn, Tân Thới Nhất, Quận 12','19/8/2020','450000', 'NV02', '5/7/1998')

-------------------------------------------------------------
CREATE TRIGGER TRG01_UPD_KHACHHANG ON KHACHHANG --BỊ LỖI
FOR UPDATE
AS
BEGIN
	IF(EXISTS (
		SELECT * 
		FROM inserted
		WHERE NGDK < (SELECT NGSINH FROM deleted)))
		BEGIN
			PRINT 'TRG01 UPDATE KH ERROR...'
			ROLLBACK TRAN
		END
	ELSE
		BEGIN
		UPDATE KHACHHANG
		SET NGDK = (SELECT NGDK FROM inserted), NGSINH = (SELECT NGSINH FROM inserted)
		WHERE SDT IN (SELECT SDT FROM inserted)
		PRINT 'TRG01 UPDATE KH SUCESSFULLY'
		END
END
DROP TRIGGER TRG01_UPD_KHACHHANG

SELECT * FROM KHACHHANG

UPDATE KHACHHANG
SET NGDK = '22/11/1994'
WHERE HOTEN = '0908200597'
------------------------------------------------------------------
CREATE TRIGGER TRG02_INS_KHACHHANG ON KHACHHANG
FOR INSERT 
AS
BEGIN
	IF (EXISTS (
		SELECT *
		FROM inserted
		WHERE DOANHSO <> 0))
		BEGIN
			PRINT 'TRG02 INSERT KH ERROR...'
			UPDATE KHACHHANG
			SET DOANHSO = 0
			WHERE SDT IN (SELECT SDT FROM inserted)
			PRINT 'TRG02 DA CAP NHAT DOANHSO = 0'
		END
	ELSE 
		PRINT 'TRG02 INSERT SUCESSFULLY'
END

DROP TRIGGER TRG02_INS_KHACHHANG

SELECT * FROM KHACHHANG

INSERT INTO KHACHHANG VALUES(N'Trần Đình Tâm','0908200597',N'Hẻm 30 Điện Biên Phủ, phường 6, Quận 3','20/11/2021','200', 'NV01', '5/6/1998')
INSERT INTO KHACHHANG VALUES(N'Nguyễn Xuân Tài','0908200598',N'Hẻm 45 Điện Biên Phủ, phường 6, Quận 3','18/10/2019','200', 'NV03', '5/6/1996')

DELETE FROM KHACHHANG WHERE SDT = '0908200598'

---------------------------------------------------------
--CREATE TRIGGER TRG02_UPD_KHACHHANG ON KHACHHANG  --CONFLICT TRG03 
--FOR UPDATE
--AS
--BEGIN
--	IF (EXISTS(
--		SELECT * 
--		FROM inserted
--		WHERE DOANHSO <> (SELECT SUM(TONGTIEN) FROM HOADON WHERE inserted.MAKH = HOADON.MAKH GROUP BY MAKH)))
--		BEGIN
--			PRINT'TRG02 UPDATE KH ERROR...'
--			ROLLBACK TRAN
--		END
--	ELSE
--		PRINT 'TRG02 UPDATE KH SUCESSFULLY'
--END

DROP TRIGGER TRG02_UPD_KHACHHANG

SELECT * FROM KHACHHANG
UPDATE KHACHHANG
SET DOANHSO = 2000
WHERE HOTEN = 'Nguyễn Hoàng Duy'
--------------------------------------------------------------------
--C1:
CREATE TRIGGER TRG02_IUD_HOADON ON HOADON
FOR INSERT, UPDATE, DELETE
AS
BEGIN
	UPDATE KHACHHANG
	SET DOANHSO = (
		SELECT  SUM (TONGTIEN)
		FROM HOADON
		WHERE HOADON.MAKH = KHACHHANG.MAKH AND HOADON.DELETED = 0
		)
	WHERE MAKH IN (SELECT MAKH FROM inserted)
	OR MAKH IN (SELECT MAKH FROM deleted)
	PRINT 'DA UPDATE DOANHSO THANH CONG'
END

DROP TRIGGER TRG02_IUD_HOADON

SELECT * FROM HOADON
SELECT *FROM KHACHHANG
UPDATE HOADON
SET TONGTIEN = 1
WHERE MAHD = 'HD001'
--C2:
--INSERT:
--CREATE TRIGGER TRG02_INS_HOADON ON HOADON
--AFTER INSERT 
--AS
--BEGIN
--		UPDATE KHACHHANG
--		SET DOANHSO = DOANHSO + (SELECT TONGTIEN FROM inserted WHERE SDT = KHACHHANG.SDT)
--		FROM KHACHHANG JOIN inserted ON KHACHHANG.SDT = inserted.SDT
--END
--GO
--DROP TRIGGER TRG02_INS_HOADON


-----------------------------------------------------------
CREATE TRIGGER TRG03_INS_HOADON ON HOADON
FOR INSERT 
AS
BEGIN
	IF(EXISTS (
		SELECT * 
		FROM inserted
		WHERE TONGTIEN <> 0))
		BEGIN
			PRINT 'TRG03 INSERT HD ERROR...'
			ROLLBACK TRAN
		END
	ELSE
		PRINT 'TRG03 INSERT HD SUCESSFULLY'
END

DROP TRIGGER TRG03_INS_HOADON

INSERT INTO HOADON VALUES('HD0011','28/10/2022','450000','0','NV03','0908200596')
--------------------------------------------------------------------------
CREATE TRIGGER TRG03_UPD_HOADON ON HOADON
FOR UPDATE
AS
BEGIN
	IF (EXISTS (
		SELECT inserted.MAHD
		FROM inserted INNER JOIN CTHD ON CTHD.MAHD = inserted.MAHD INNER JOIN SANPHAM ON  SANPHAM.MASP = CTHD.MASP
		GROUP BY inserted.MAHD
		HAVING SUM ( SOLUONG *GIA ) <> (SELECT TONGTIEN FROM inserted)))
		BEGIN
			PRINT 'TRG03 UPDATE HD ERROR...'
			ROLLBACK TRAN
		END
	ELSE
		PRINT 'TRG03 UPDATE HD SUCESSFULLY'
END

DROP TRIGGER TRG03_UPD_HOADON

UPDATE HOADON
SET TONGTIEN = 0
WHERE MAHD = 'HD0010'
--------------------------------------------------------------------------
CREATE TRIGGER TRG03_IUD_CTHD ON CTHD
FOR INSERT, UPDATE, DELETE
AS
BEGIN
	UPDATE HOADON
	SET TONGTIEN = (
		SELECT SUM (SOLUONG * GIA)
		FROM CTHD INNER JOIN SANPHAM ON CTHD.MASP = SANPHAM.MASP
		WHERE HOADON.MAHD = CTHD.MAHD
		GROUP BY MAHD)
	WHERE MAHD IN (SELECT MAHD FROM inserted)
	OR MAHD IN (SELECT MAHD FROM deleted)
	PRINT 'DA UPDATE TONGTIEN THANH CONG'
END

DROP TRIGGER TRG03_IUD_CTHD

-------------------------------------------------------
CREATE TRIGGER TRG03_UPD_SANPHAM ON SANPHAM
FOR UPDATE
AS
BEGIN
	UPDATE HOADON
	SET TONGTIEN = (
		SELECT SUM (SOLUONG * GIA)
		FROM CTHD INNER JOIN SANPHAM ON CTHD.MASP = SANPHAM.MASP
		WHERE HOADON.MAHD = CTHD.MAHD
		GROUP BY MAHD)
	FROM HOADON INNER JOIN CTHD ON HOADON.MAHD = CTHD.MAHD INNER JOIN inserted ON CTHD.MASP = inserted.MASP
	PRINT 'DA UPDATE TONGTIEN THANH CONG'
END

DROP TRIGGER TRG03_UPD_SANPHAM
 UPDATE SANPHAM
 SET GIA = 21000000
 WHERE MASP = 'SP001'

 SELECT * FROM SANPHAM
 SELECT * FROM KHACHHANG
 SELECT * FROM HOADON
--------------------------------------------------------
--TRG04: Khi thêm một chi tiết hóa đơn thì số lượng hàng tồn kho sẽ giảm 
CREATE TRIGGER TRG04_INS_CTHD ON CTHD
FOR INSERT
AS
BEGIN
	UPDATE TONKHO
	SET SOLUONG = SOLUONG - (SELECT SOLUONG FROM inserted)
	WHERE MASP IN (SELECT MASP FROM inserted)
END

DROP TRIGGER TRG04_INS_CTHD

------------------------------------------------------------------
CREATE TRIGGER TRG04_DEL_CTHD ON CTHD
FOR DELETE
AS
BEGIN
	UPDATE TONKHO
	SET SOLUONG = SOLUONG + (SELECT SOLUONG FROM deleted)
	WHERE MASP IN (SELECT MASP FROM deleted)
END

DROP TRIGGER TRG04_DEL_CTHD

---------------------------------------------------------------
CREATE TRIGGER TRG04_UPD_CTHD ON CTHD
FOR UPDATE
AS
BEGIN
	UPDATE TONKHO
	SET SOLUONG = SOLUONG + (SELECT SOLUONG FROM deleted) - (SELECT SOLUONG FROM inserted)
	WHERE MASP IN (SELECT MASP FROM inserted)
END

DROP TRIGGER TRG04_UPD_CTHD

--------------------------------------------------
-- TRG5: TRIGGER KIỂM TRA THÊM VÀ UPDATE CÁC USERNAME TRONG BẢNG LOGIN KHÔNG ĐƯỢC TRÙNG NHAU
--CREATE TRIGGER TRG05_INS_UPD_LOGIN ON LOGIN
--AFTER INSERT, UPDATE
--AS 
--BEGIN
--	IF (EXISTS (
--			SELECT * 
--			FROM inserted
--			WHERE (SELECT COUNT(*) FROM LOGIN LG WHERE LG.USERNAME = inserted.USERNAME) > 1))
--			BEGIN
--				PRINT 'USERNAME HAS ALREADY EXISTED!'
--				ROLLBACK TRAN
--			END
--	ELSE
--		PRINT 'LOGIN SUCESSFULLY'
--END

select * from NHANVIEN

ALTER TABLE NHANVIEN ADD IMG_PATH NVARCHAR(MAX)


--TRIGGER 6: TỔNG TIỀN CỦA MỘT PHIẾU NHẬP BẰNG TỔNG SỐ LƯƠNG * GIÁ TIỀN
CREATE TRIGGER TRG06_INS_PHIEUNHAP ON PHIEUNHAP
FOR INSERT 
AS
BEGIN
	IF(EXISTS (
		SELECT * 
		FROM inserted
		WHERE TONGTIEN <> 0))
		BEGIN
			PRINT 'TRG06 INSERT PN ERROR...'
			ROLLBACK TRAN
		END
	ELSE
		PRINT 'TRG06 INSERT PN SUCESSFULLY'
END

DROP TRIGGER TRG06_INS_PHIEUNHAP

--------------------------------------------------------------------------
CREATE TRIGGER TRG06_UPD_PHIEUNHAP ON PHIEUNHAP
FOR UPDATE
AS
BEGIN
	IF (EXISTS (
		SELECT inserted.MAPN
		FROM inserted INNER JOIN CTPN ON CTPN.MAPN = inserted.MAPN INNER JOIN SANPHAM ON  SANPHAM.MASP = CTPN.MASP
		GROUP BY inserted.MAPN
		HAVING SUM ( SOLUONG *GIA ) <> (SELECT TONGTIEN FROM inserted)))
		BEGIN
			PRINT 'TRG06 UPDATE PN ERROR...'
			ROLLBACK TRAN
		END
	ELSE
		PRINT 'TRG06 UPDATE PN SUCESSFULLY'
END

DROP TRIGGER TRG06_UPD_PHIEUNHAP

--------------------------------------------------------------------------
CREATE TRIGGER TRG06_IUD_CTPN ON CTPN
FOR INSERT, UPDATE, DELETE
AS
BEGIN
	UPDATE PHIEUNHAP
	SET TONGTIEN = (
		SELECT SUM (SOLUONG * GIA)
		FROM CTPN INNER JOIN SANPHAM ON CTPN.MASP = SANPHAM.MASP
		WHERE PHIEUNHAP.MAPN = CTPN.MAPN
		GROUP BY MAPN)
	WHERE MAPN IN (SELECT MAPN FROM inserted)
	OR MAPN IN (SELECT MAPN FROM deleted)
	PRINT 'DA UPDATE TONGTIEN THANH CONG'
END
